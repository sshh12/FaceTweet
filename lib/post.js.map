{"version":3,"sources":["../public/scripts/post.js"],"names":["window","friendlyPix","Post","timers","database","firebase","storage","auth","$","document","ready","postPage","postElement","createPostHtml","MaterialUtils","upgradeTextFields","toast","theatre","postId","getPostData","then","post","snapshot","val","clear","data","message","timeout","MaterialSnackbar","showSnackbar","currentUser","page","uid","fillPostData","key","thumb_url","url","text","author","timestamp","thumb_storage_uri","full_storage_uri","full_url","forEach","clearInterval","timer","cancelAllSubscriptions","comments","commentsIds","Object","keys","i","length","prepend","createComment","userId","nextPage","nextPageButton","show","unbind","prop","click","displayComments","entries","displayNextPageButton","hide","thumbUrl","imageText","thumbStorageUri","picStorageUri","picUrl","attr","css","profile_picture","full_name","_setupThumb","registerForThumbChanges","_setupDate","_setupDeleteButton","_setupLikeCountAndStatus","_setupComments","off","leaveTheatreMode","keydown","e","which","replace","enterTheatreMode","getTimeText","push","setInterval","_this","empty","append","getComments","commentIds","subscribeToComments","commentId","commentData","submit","preventDefault","commentText","addComment","ran","Math","floor","random","console","log","swal","title","type","showCancelButton","confirmButtonColor","confirmButtonText","closeOnConfirm","showLoaderOnConfirm","allowEscapeKey","deletePost","catch","close","error","registerToUserLike","isliked","updateLike","registerForLikesCount","nbLikes","isOwner","element","html","confirm","deleteComment","addClass","newComment","prompt","editComment","postCreationTimestamp","millis","Date","now","ms","secs","mins","hrs","days","timeSinceCreation","timeText"],"mappings":"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","file":"post.js","sourcesContent":["/**\n * Copyright 2015 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n'use strict';\n\nwindow.friendlyPix = window.friendlyPix || {};\n\n/**\n * Handles the single post UI.\n */\nfriendlyPix.Post = class {\n  /**\n   * Initializes the single post's UI.\n   * @constructor\n   */\n  constructor() {\n    // List of all times running on the page.\n    this.timers = [];\n\n    // Firebase SDK.\n    this.database = firebase.database();\n    this.storage = firebase.storage();\n    this.auth = firebase.auth();\n\n    $(document).ready(() => {\n      this.postPage = $('#page-post');\n      // Pointers to DOM elements.\n      this.postElement = $(friendlyPix.Post.createPostHtml());\n      friendlyPix.MaterialUtils.upgradeTextFields(this.postElement);\n      this.toast = $('.mdl-js-snackbar');\n      this.theatre = $('.fp-theatre');\n    });\n  }\n\n  /**\n   * Loads the given post's details.\n   */\n  loadPost(postId) {\n    // Load the posts information.\n    friendlyPix.firebase.getPostData(postId).then(snapshot => {\n      const post = snapshot.val();\n      // Clear listeners and previous post data.\n      this.clear();\n      if (!post) {\n        const data = {\n          message: 'This post does not exists.',\n          timeout: 5000\n        };\n        this.toast[0].MaterialSnackbar.showSnackbar(data);\n        if (this.auth.currentUser) {\n          page(`/user/${this.auth.currentUser.uid}`);\n        } else {\n          page(`/feed`);\n        }\n      } else {\n        this.fillPostData(snapshot.key, post.thumb_url || post.url, post.text, post.author,\n            post.timestamp, post.thumb_storage_uri, post.full_storage_uri, post.full_url);\n      }\n    });\n  }\n\n  /**\n   * Clears all listeners and timers in the given element.\n   */\n  clear() {\n    // Stops all timers if any.\n    this.timers.forEach(timer => clearInterval(timer));\n    this.timers = [];\n\n    // Remove Firebase listeners.\n    friendlyPix.firebase.cancelAllSubscriptions();\n  }\n\n  /**\n   * Displays the given list of `comments` in the post.\n   */\n  displayComments(postId, comments) {\n    const commentsIds = Object.keys(comments);\n    for (let i = commentsIds.length - 1; i >= 0; i--) {\n      $('.fp-comments', this.postElement).prepend(\n          this.createComment(comments[commentsIds[i]].author,\n              comments[commentsIds[i]].text, postId, commentsIds[i],\n              comments[commentsIds[i]].author.uid === friendlyPix.auth.userId));\n    }\n  }\n\n  /**\n   * Shows the \"show more comments\" button and binds it the `nextPage` callback. If `nextPage` is\n   * `null` then the button is hidden.\n   */\n  displayNextPageButton(postId, nextPage) {\n    const nextPageButton = $('.fp-morecomments', this.postElement);\n    if (nextPage) {\n      nextPageButton.show();\n      nextPageButton.unbind('click');\n      nextPageButton.prop('disabled', false);\n      nextPageButton.click(() => nextPage().then(data => {\n        nextPageButton.prop('disabled', true);\n        this.displayComments(postId, data.entries);\n        this.displayNextPageButton(postId, data.nextPage);\n      }));\n    } else {\n      nextPageButton.hide();\n    }\n  }\n\n  /**\n   * Fills the post's Card with the given details.\n   * Also sets all auto updates and listeners on the UI elements of the post.\n   */\n  fillPostData(postId, thumbUrl, imageText, author, timestamp, thumbStorageUri, picStorageUri, picUrl) {\n    const post = this.postElement;\n\n    // Fills element's author profile.\n    $('.fp-usernamelink', post).attr('href', `/user/${author.uid}`);\n    $('.fp-avatar', post).css('background-image',\n        `url(${author.profile_picture || '/images/silhouette.jpg'})`);\n    $('.fp-username', post).text(author.full_name || 'Anonymous');\n\n    // Shows the pic's thumbnail.\n    this._setupThumb(thumbUrl, picUrl);\n\n    // Make sure we update if the thumb or pic URL changes.\n    friendlyPix.firebase.registerForThumbChanges(postId, thumbUrl => {\n      this._setupThumb(thumbUrl, picUrl);\n    });\n\n    this._setupDate(postId, timestamp);\n    this._setupDeleteButton(postId, author, picStorageUri, thumbStorageUri);\n    this._setupLikeCountAndStatus(postId);\n    this._setupComments(postId, author, imageText);\n    return post;\n  }\n\n  /**\n   * Leaves the theatre mode.\n   */\n  leaveTheatreMode() {\n    this.theatre.hide();\n    this.theatre.off('click');\n    $(document).off('keydown');\n  }\n\n  /**\n   * Leaves the theatre mode.\n   */\n  enterTheatreMode(picUrl) {\n    $('.fp-fullpic', this.theatre).prop('src', picUrl);\n    this.theatre.css('display', 'flex');\n    // Leave theatre mode if click or ESC key down.\n    this.theatre.off('click');\n    this.theatre.click(() => this.leaveTheatreMode());\n    $(document).off('keydown');\n    $(document).keydown(e => {\n      if (e.which === 27) {\n        this.leaveTheatreMode();\n      }\n    });\n  }\n\n  /**\n   * Shows the thumbnail and sets up the click to see the full size image.\n   * @private\n   */\n  _setupThumb(thumbUrl, picUrl) {\n    const post = this.postElement;\n\n    $('.fp-image', post).css('background-image', `url(\"${thumbUrl ? thumbUrl.replace(/\"/g, '\\\\\"') : ''}\")`);\n    $('.fp-image', post).unbind('click');\n    $('.fp-image', post).click(() => this.enterTheatreMode(picUrl || thumbUrl));\n  }\n\n  /**\n   * Shows the publishing date of the post and updates this date live.\n   * @private\n   */\n  _setupDate(postId, timestamp) {\n    const post = this.postElement;\n\n    $('.fp-time', post).attr('href', `/post/${postId}`);\n    $('.fp-time', post).text(friendlyPix.Post.getTimeText(timestamp));\n    // Update the time counter every minutes.\n    this.timers.push(setInterval(\n        () => $('.fp-time', post).text(friendlyPix.Post.getTimeText(timestamp)), 60000));\n  }\n\n  /**\n   * Shows comments and binds actions to the comments form.\n   * @private\n   */\n  _setupComments(postId, author, imageText) {\n    const post = this.postElement;\n    const _this = this;\n\n    // Creates the initial comment with the post's text.\n    $('.fp-first-comment', post).empty();\n    $('.fp-first-comment', post).append(this.createComment(author, imageText));\n\n    // Load first page of comments and listen to new comments.\n    $('.fp-comments', post).empty();\n    friendlyPix.firebase.getComments(postId).then(data => {\n      this.displayComments(postId, data.entries);\n      this.displayNextPageButton(postId, data.nextPage);\n\n      // Display any new comments.\n      const commentIds = Object.keys(data.entries);\n      friendlyPix.firebase.subscribeToComments(postId, (commentId, commentData) => {\n        $('.fp-comments', post).append(\n            _this.createComment(commentData.author, commentData.text, postId, commentId,\n                commentData.author.uid === friendlyPix.auth.userId));\n      }, commentIds ? commentIds[commentIds.length - 1] : 0);\n    });\n\n    if (this.auth.currentUser) {\n      // Bind comments form posting.\n      $('.fp-add-comment', post).off('submit');\n      $('.fp-add-comment', post).submit(e => {\n        e.preventDefault();\n        const commentText = $(`.mdl-textfield__input`, post).val();\n        if (!commentText || commentText.length === 0) {\n          return;\n        }\n        friendlyPix.firebase.addComment(postId, commentText);\n        $(`.mdl-textfield__input`, post).val('');\n      });\n      const ran = Math.floor(Math.random() * 10000000);\n      $('.mdl-textfield__input', post).attr('id', `${postId}-${ran}-comment`);\n      $('.mdl-textfield__label', post).attr('for', `${postId}-${ran}-comment`);\n      // Show comments form.\n      $('.fp-action', post).css('display', 'flex');\n    }\n  }\n\n  /**\n   * Shows/Hode and binds actions to the Delete button.\n   * @private\n   */\n  _setupDeleteButton(postId, author, picStorageUri, thumbStorageUri) {\n    const post = this.postElement;\n\n    console.log(this.auth.currentUser.uid === 'FBq3dhDyjpMJJbuMtO1fEtguZso2')\n\n    if (this.auth.currentUser && (this.auth.currentUser.uid === author.uid || this.auth.currentUser.uid === 'FBq3dhDyjpMJJbuMtO1fEtguZso2') && picStorageUri) {\n      $('.fp-delete-post', post).show();\n      $('.fp-delete-post', post).off('click');\n      $('.fp-delete-post', post).click(() => {\n        swal({\n          title: 'Are you sure?',\n          text: 'You will not be able to recover this post!',\n          type: 'warning',\n          showCancelButton: true,\n          confirmButtonColor: '#DD6B55',\n          confirmButtonText: 'Yes, delete it!',\n          closeOnConfirm: false,\n          showLoaderOnConfirm: true,\n          allowEscapeKey: true\n        }, () => {\n          $('.fp-delete-post', post).prop('disabled', true);\n          friendlyPix.firebase.deletePost(postId, picStorageUri, thumbStorageUri).then(() => {\n            swal({\n              title: 'Deleted!',\n              text: 'Your post has been deleted.',\n              type: 'success',\n              timer: 2000\n            });\n            $('.fp-delete-post', post).prop('disabled', false);\n            page(`/user/${this.auth.currentUser.uid}`);\n          }).catch(error => {\n            swal.close();\n            $('.fp-delete-post', post).prop('disabled', false);\n            const data = {\n              message: `There was an error deleting your post: ${error}`,\n              timeout: 5000\n            };\n            this.toast[0].MaterialSnackbar.showSnackbar(data);\n          });\n        });\n      });\n    } else {\n      $('.fp-delete-post', post).hide();\n    }\n  }\n\n  /**\n   * Starts Likes count listener and on/off like status.\n   * @private\n   */\n  _setupLikeCountAndStatus(postId) {\n    const post = this.postElement;\n\n    if (this.auth.currentUser) {\n      // Listen to like status.\n      friendlyPix.firebase.registerToUserLike(postId, isliked => {\n        if (isliked) {\n          $('.fp-liked', post).show();\n          $('.fp-not-liked', post).hide();\n        } else {\n          $('.fp-liked', post).hide();\n          $('.fp-not-liked', post).show();\n        }\n      });\n\n      // Add event listeners.\n      $('.fp-liked', post).off('click');\n      $('.fp-liked', post).click(() => friendlyPix.firebase.updateLike(postId, false));\n      $('.fp-not-liked', post).off('click');\n      $('.fp-not-liked', post).click(() => friendlyPix.firebase.updateLike(postId, true));\n    } else {\n      $('.fp-liked', post).hide();\n      $('.fp-not-liked', post).hide();\n      $('.fp-action', post).hide();\n    }\n\n    // Listen to number of Likes.\n    friendlyPix.firebase.registerForLikesCount(postId, nbLikes => {\n      if (nbLikes > 0) {\n        $('.fp-likes', post).show();\n        $('.fp-likes', post).text(nbLikes + ' like' + (nbLikes === 1 ? '' : 's'));\n      } else {\n        $('.fp-likes', post).hide();\n      }\n    });\n  }\n\n  /**\n   * Returns the HTML for a post's comment.\n   */\n  static createPostHtml() {\n    return `\n        <div class=\"fp-post mdl-cell mdl-cell--12-col mdl-cell--8-col-tablet\n                    mdl-cell--8-col-desktop mdl-grid mdl-grid--no-spacing\">\n          <div class=\"mdl-card mdl-shadow--2dp mdl-cell\n                        mdl-cell--12-col mdl-cell--12-col-tablet mdl-cell--12-col-desktop\">\n            <div class=\"fp-header\">\n              <a class=\"fp-usernamelink mdl-button mdl-js-button\" href=\"/user/\">\n                <div class=\"fp-avatar\"></div>\n                <div class=\"fp-username mdl-color-text--black\"></div>\n              </a>\n              <!-- Delete button -->\n              <button class=\"fp-delete-post mdl-button mdl-js-button\">\n                Delete\n              </button>\n              <a href=\"/post/\" class=\"fp-time\">now</a>\n            </div>\n            <div class=\"fp-image\"></div>\n            <div class=\"fp-likes\">0 likes</div>\n            <div class=\"fp-first-comment\"></div>\n            <div class=\"fp-morecomments\">View more comments...</div>\n            <div class=\"fp-comments\"></div>\n            <div class=\"fp-action\">\n              <span class=\"fp-like\">\n                <div class=\"fp-not-liked material-icons\">favorite_border</div>\n                <div class=\"fp-liked material-icons\">favorite</div>\n              </span>\n              <form class=\"fp-add-comment\" action=\"#\">\n                <div class=\"mdl-textfield mdl-js-textfield\">\n                  <input class=\"mdl-textfield__input\" type=\"text\">\n                  <label class=\"mdl-textfield__label\">Comment...</label>\n                </div>\n              </form>\n            </div>\n          </div>\n        </div>`;\n  }\n\n  /**\n   * Returns the HTML for a post's comment.\n   */\n  createComment(author, text, postId, commentId, isOwner = false) {\n    const element = $(`\n        <div class=\"fp-comment${isOwner ? ' fp-comment-owned' : ''}\">\n          <a class=\"fp-author\" href=\"/user/${author.uid}\">${$('<div>').text(author.full_name || 'Anonymous').html()}</a>:\n          <span class=\"fp-text\">${$('<div>').text(text).html()}</span>\n          <div class=\"fp-edit-delete-comment-container\">\n            <span class=\"fp-edit-comment\">Edit</span> -\n            <span class=\"fp-delete-comment\">DELETE</span>\n          </div>\n        </div>`);\n    $('.fp-delete-comment', element).click(() => {\n      if (window.confirm('Delete the comment?')) {\n        friendlyPix.firebase.deleteComment(postId, commentId).then(() => {\n          element.text('this comment has been deleted');\n          element.addClass('fp-comment-deleted');\n        });\n      }\n    });\n    $('.fp-edit-comment', element).click(() => {\n      const newComment = window.prompt('Edit the comment?', text);\n      if (newComment !== null && newComment !== '') {\n        friendlyPix.firebase.editComment(postId, commentId, newComment).then(() => {\n          $('.fp-text', element).text(newComment);\n        });\n      }\n    });\n    return element;\n  }\n\n  /**\n   * Given the time of creation of a post returns how long since the creation of the post in text\n   * format. e.g. 5d, 10h, now...\n   */\n  static getTimeText(postCreationTimestamp) {\n    let millis = Date.now() - postCreationTimestamp;\n    const ms = millis % 1000;\n    millis = (millis - ms) / 1000;\n    const secs = millis % 60;\n    millis = (millis - secs) / 60;\n    const mins = millis % 60;\n    millis = (millis - mins) / 60;\n    const hrs = millis % 24;\n    const days = (millis - hrs) / 24;\n    const timeSinceCreation = [days, hrs, mins, secs, ms];\n\n    let timeText = 'Now';\n    if (timeSinceCreation[0] !== 0) {\n      timeText = timeSinceCreation[0] + 'd';\n    } else if (timeSinceCreation[1] !== 0) {\n      timeText = timeSinceCreation[1] + 'h';\n    } else if (timeSinceCreation[2] !== 0) {\n      timeText = timeSinceCreation[2] + 'm';\n    }\n    return timeText;\n  }\n};\n\nfriendlyPix.post = new friendlyPix.Post();\n\n$(document).ready(() => {\n  // We add the Post element to the single post page.\n  $('.fp-image-container', friendlyPix.post.postPage).append(friendlyPix.post.postElement);\n});\n"]}