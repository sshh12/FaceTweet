{"version":3,"sources":["../public/scripts/routing.js"],"names":["window","friendlyPix","Router","$","document","ready","auth","waitForAuth","then","pagesElements","splashLogin","location","pathname","page","pipe","displayPage","bind","loadUser","userPage","userId","showHomeFeed","feed","showGeneralFeed","clearFeed","clear","showPost","post","loadPost","postId","pageId","onlyAuthed","attributes","context","firebase","currentUser","show","setLinkAsActive","canonicalPath","each","index","element","id","fadeOut","hide","MaterialUtils","closeDrawer","scrollToTop","path","animate","scrollTop","funct","attribute","optContinue","next","params","Object","keys","length","removeClass","addClass","router"],"mappings":"AAAA;;;;;;;;;;;;;;;AAeA,a;;AAEAA,OAAOC,WAAP,GAAqBD,OAAOC,WAAP,IAAsB,EAA3C;;AAEA;;;AAGAA,YAAYC,MAAZ;;AAEE;;;;AAIA,oBAAc;AACZC,MAAEC,QAAF,EAAYC,KAAZ,CAAkB,YAAM;AACtBJ,kBAAYK,IAAZ,CAAiBC,WAAjB,CAA6BC,IAA7B,CAAkC,YAAM;AACtC;AACA,cAAKC,aAAL,GAAqBN,EAAE,aAAF,CAArB;AACA,cAAKO,WAAL,GAAmBP,EAAE,QAAF,EAAY,cAAZ,CAAnB;;AAEA;AACA,YAAIH,OAAOW,QAAP,CAAgBC,QAAhB,KAA6B,MAAjC,EAAyC;AACvCC,eAAK,GAAL;AACD;;AAED;AACA,YAAMC,OAAOb,YAAYC,MAAZ,CAAmBY,IAAhC;AACA,YAAMC,cAAc,MAAKA,WAAL,CAAiBC,IAAjB,OAApB;AACA,YAAMC,WAAW,SAAXA,QAAW,iBAAUhB,YAAYiB,QAAZ,CAAqBD,QAArB,CAA8BE,MAA9B,CAAV,EAAjB;AACA,YAAMC,eAAe,SAAfA,YAAe,WAAMnB,YAAYoB,IAAZ,CAAiBD,YAAjB,EAAN,EAArB;AACA,YAAME,kBAAkB,SAAlBA,eAAkB,WAAMrB,YAAYoB,IAAZ,CAAiBC,eAAjB,EAAN,EAAxB;AACA,YAAMC,YAAY,SAAZA,SAAY,WAAMtB,YAAYoB,IAAZ,CAAiBG,KAAjB,EAAN,EAAlB;AACA,YAAMC,WAAW,SAAXA,QAAW,iBAAUxB,YAAYyB,IAAZ,CAAiBC,QAAjB,CAA0BC,MAA1B,CAAV,EAAjB;;AAEAf,aAAK,GAAL,EAAUC,KAAKM,YAAL,EAAmB,IAAnB,EAAyB,IAAzB,CAAV;AACIN,aAAKC,WAAL,EAAkB,EAACc,QAAQ,MAAT,EAAiBC,YAAY,IAA7B,EAAlB,CADJ;AAEAjB,aAAK,OAAL,EAAcC,KAAKQ,eAAL,EAAsB,IAAtB,EAA4B,IAA5B,CAAd,EAAiDR,KAAKC,WAAL,EAAkB,EAACc,QAAQ,MAAT,EAAlB,CAAjD;AACAhB,aAAK,eAAL,EAAsBC,KAAKW,QAAL,EAAe,IAAf,EAAqB,IAArB,CAAtB,EAAkDX,KAAKC,WAAL,EAAkB,EAACc,QAAQ,MAAT,EAAlB,CAAlD;AACAhB,aAAK,eAAL,EAAsBC,KAAKG,QAAL,EAAe,IAAf,EAAqB,IAArB,CAAtB,EAAkDH,KAAKC,WAAL,EAAkB,EAACc,QAAQ,WAAT,EAAlB,CAAlD;AACAhB,aAAK,QAAL,EAAeC,KAAKS,SAAL,EAAgB,IAAhB,EAAsB,IAAtB,CAAf,EAA4CT,KAAKC,WAAL,EAAkB,EAACc,QAAQ,OAAT,EAAlB,CAA5C;AACAhB,aAAK,MAAL,EAAaC,KAAKC,WAAL,EAAkB,EAACc,QAAQ,KAAT,EAAgBC,YAAY,IAA5B,EAAlB,CAAb;AACAjB,aAAK,GAAL,EAAU,oBAAMA,KAAK,GAAL,CAAN,EAAV;;AAEA;AACAA;AACD,OA9BD;AA+BD,KAhCD;AAiCD;;AAED;;;;OA1CF;AA+CckB,cA/Cd,EA+C0BC,OA/C1B,EA+CmC;AAC/B,UAAMF,aAAaC,WAAWD,UAA9B;AACA,UAAID,SAASE,WAAWF,MAAxB;;AAEA,UAAIC,cAAc,CAACG,SAAS3B,IAAT,GAAgB4B,WAAnC,EAAgD;AAC9CL,iBAAS,QAAT;AACA,aAAKnB,WAAL,CAAiByB,IAAjB;AACD;AACDlC,kBAAYC,MAAZ,CAAmBkC,eAAnB,CAAmCJ,QAAQK,aAA3C;AACA,WAAK5B,aAAL,CAAmB6B,IAAnB,CAAwB,UAASC,KAAT,EAAgBC,OAAhB,EAAyB;AAC/C,YAAIA,QAAQC,EAAR,KAAe,UAAUZ,MAA7B,EAAqC;AACnC1B,YAAEqC,OAAF,EAAWL,IAAX;AACD,SAFD,MAEO,IAAIK,QAAQC,EAAR,KAAe,aAAnB,EAAkC;AACvCtC,YAAEqC,OAAF,EAAWE,OAAX,CAAmB,IAAnB;AACD,SAFM,MAEA;AACLvC,YAAEqC,OAAF,EAAWG,IAAX;AACD;AACF,OARD;AASA1C,kBAAY2C,aAAZ,CAA0BC,WAA1B;AACA5C,kBAAYC,MAAZ,CAAmB4C,WAAnB;AACD;;AAED;;SArEF;AAwEe;AACX,UAAIC,OAAO/C,OAAOW,QAAP,CAAgBC,QAA3B;AACA,UAAImC,SAAS,EAAb,EAAiB;AACfA,eAAO,GAAP;AACD;AACDlC,WAAKkC,IAAL;AACD;;AAED;;SAhFF;AAmFuB;AACnB5C,QAAE,WAAF,EAAe6C,OAAf,CAAuB,EAACC,WAAW,CAAZ,EAAvB,EAAuC,CAAvC;AACD;;AAED;;;SAvFF;AA2FcC,SA3Fd,EA2FqBC,SA3FrB,EA2FgCC,WA3FhC,EA2F6C;AACzC,aAAO,UAACpB,OAAD,EAAUqB,IAAV,EAAmB;AACxB,YAAIH,KAAJ,EAAW;AACT,cAAMI,SAASC,OAAOC,IAAP,CAAYxB,QAAQsB,MAApB,CAAf;AACA,cAAI,CAACH,SAAD,IAAcG,OAAOG,MAAP,GAAgB,CAAlC,EAAqC;AACnCP,kBAAMlB,QAAQsB,MAAR,CAAeA,OAAO,CAAP,CAAf,CAAN,EAAiCtB,OAAjC;AACD,WAFD,MAEO;AACLkB,kBAAMC,SAAN,EAAiBnB,OAAjB;AACD;AACF;AACD,YAAIoB,WAAJ,EAAiB;AACfC;AACD;AACF,OAZD;AAaD;;AAED;;SA3GF;AA8GyBhB,iBA9GzB,EA8GwC;AACpC,UAAIA,kBAAkB,EAAtB,EAA0B;AACxBA,wBAAgB,GAAhB;AACD;AACDlC,QAAE,YAAF,EAAgBuD,WAAhB,CAA4B,WAA5B;AACAvD,oBAAYkC,aAAZ,SAA+BsB,QAA/B,CAAwC,WAAxC;AACD,KApHH;;;AAuHA1D,YAAY2D,MAAZ,GAAqB,IAAI3D,YAAYC,MAAhB,EAArB","file":"routing.js","sourcesContent":["/**\n * Copyright 2015 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n'use strict';\n\nwindow.friendlyPix = window.friendlyPix || {};\n\n/**\n * Handles the pages/routing.\n */\nfriendlyPix.Router = class {\n\n  /**\n   * Initializes the Friendly Pix controller/router.\n   * @constructor\n   */\n  constructor() {\n    $(document).ready(() => {\n      friendlyPix.auth.waitForAuth.then(() => {\n        // Dom elements.\n        this.pagesElements = $('[id^=page-]');\n        this.splashLogin = $('#login', '#page-splash');\n\n        // Make sure /add is never opened on website load.\n        if (window.location.pathname === '/add') {\n          page('/');\n        }\n\n        // Configuring routes.\n        const pipe = friendlyPix.Router.pipe;\n        const displayPage = this.displayPage.bind(this);\n        const loadUser = userId => friendlyPix.userPage.loadUser(userId);\n        const showHomeFeed = () => friendlyPix.feed.showHomeFeed();\n        const showGeneralFeed = () => friendlyPix.feed.showGeneralFeed();\n        const clearFeed = () => friendlyPix.feed.clear();\n        const showPost = postId => friendlyPix.post.loadPost(postId);\n\n        page('/', pipe(showHomeFeed, null, true),\n            pipe(displayPage, {pageId: 'feed', onlyAuthed: true}));\n        page('/feed', pipe(showGeneralFeed, null, true), pipe(displayPage, {pageId: 'feed'}));\n        page('/post/:postId', pipe(showPost, null, true), pipe(displayPage, {pageId: 'post'}));\n        page('/user/:userId', pipe(loadUser, null, true), pipe(displayPage, {pageId: 'user-info'}));\n        page('/about', pipe(clearFeed, null, true), pipe(displayPage, {pageId: 'about'}));\n        page('/add', pipe(displayPage, {pageId: 'add', onlyAuthed: true}));\n        page('*', () => page('/'));\n\n        // Start routing.\n        page();\n      });\n    });\n  }\n\n  /**\n   * Returns a function that displays the given page and hides the other ones.\n   * if `onlyAuthed` is set to true then the splash page will be displayed instead of the page if\n   * the user is not signed-in.\n   */\n  displayPage(attributes, context) {\n    const onlyAuthed = attributes.onlyAuthed;\n    let pageId = attributes.pageId;\n\n    if (onlyAuthed && !firebase.auth().currentUser) {\n      pageId = 'splash';\n      this.splashLogin.show();\n    }\n    friendlyPix.Router.setLinkAsActive(context.canonicalPath);\n    this.pagesElements.each(function(index, element) {\n      if (element.id === 'page-' + pageId) {\n        $(element).show();\n      } else if (element.id === 'page-splash') {\n        $(element).fadeOut(1000);\n      } else {\n        $(element).hide();\n      }\n    });\n    friendlyPix.MaterialUtils.closeDrawer();\n    friendlyPix.Router.scrollToTop();\n  }\n\n  /**\n   * Reloads the current page.\n   */\n  reloadPage() {\n    let path = window.location.pathname;\n    if (path === '') {\n      path = '/';\n    }\n    page(path);\n  }\n\n  /**\n   * Scrolls the page to top.\n   */\n  static scrollToTop() {\n    $('html,body').animate({scrollTop: 0}, 0);\n  }\n\n  /**\n   * Pipes the given function and passes the given attribute and Page.js context.\n   * Set 'optContinue' to true if there are further functions to call.\n   */\n  static pipe(funct, attribute, optContinue) {\n    return (context, next) => {\n      if (funct) {\n        const params = Object.keys(context.params);\n        if (!attribute && params.length > 0) {\n          funct(context.params[params[0]], context);\n        } else {\n          funct(attribute, context);\n        }\n      }\n      if (optContinue) {\n        next();\n      }\n    };\n  }\n\n  /**\n   * Highlights the correct menu item/link.\n   */\n  static setLinkAsActive(canonicalPath) {\n    if (canonicalPath === '') {\n      canonicalPath = '/';\n    }\n    $('.is-active').removeClass('is-active');\n    $(`[href=\"${canonicalPath}\"]`).addClass('is-active');\n  }\n};\n\nfriendlyPix.router = new friendlyPix.Router();\n"]}